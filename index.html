<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social Watch</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="16x16"
    href="https://yt3.ggpht.com/xdwy80PUa6YIR6TkM2FfRAGi6ojTZ3H8H0Yw-KiYGYdP5wgLp7dYqdJipcWcFnHKWkeXBhKvUw4=s88-c-k-c0x00ffffff-no-rj">
  <link rel="apple-touch-icon" sizes="180x180"
    href="https://yt3.ggpht.com/xdwy80PUa6YIR6TkM2FfRAGi6ojTZ3H8H0Yw-KiYGYdP5wgLp7dYqdJipcWcFnHKWkeXBhKvUw4=s88-c-k-c0x00ffffff-no-rj">
  <meta name="theme-color" content="#672162">
</head>

<body>
<header class="header">
  <div class="container">
    <div class="header-content">
      <!-- Mantendo sua logo e nome -->
      <div class="logo-section">
        <img src="https://www.socialsa.com/wp-content/uploads/2024/11/Logo-Colorida-2.webp"
          alt="Social Digital Commerce" class="brand-logo" width="28" height="28" decoding="async" loading="eager" />
        <h1>Social Watch</h1>
      </div>
      
      <!-- Botões atualizados com estilo minimalista -->
      <div class="header-actions">
        <button class="header-btn" id="metricsBtn" onclick="openMetricsPage()">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M3,3V21H21V19H5V3H3M9,17H7V10H9V17M13,17H11V7H13V17M17,17H15V13H17V17M19,17H17V4H15V2H19V17Z"/>
          </svg>
          <span>Métricas</span>
        </button>
        
        <button class="header-btn btn-primary" id="runPipelineBtn" aria-live="polite">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
          </svg>
          <span>Executar Pipeline</span>
          <span class="btn-spinner-slot" aria-hidden="true"></span>
        </button>
        
        <div class="auto-refresh">
          <i class="fas fa-sync-alt" id="refreshIcon"></i>
          <span>Auto-refresh: <span id="refreshTime">30s</span></span>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Dashboard Content -->
      <section class="dashboard-content">
        <!-- Statistics Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon stat-icon--success"><i class="fas fa-check-circle"></i></div>
            <div class="stat-content">
              <h3 id="totalPassed">0</h3>
              <p>Testes Aprovados</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon stat-icon--error"><i class="fas fa-times-circle"></i></div>
            <div class="stat-content">
              <h3 id="totalFailed">0</h3>
              <p>Testes Falhados</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon stat-icon--info"><i class="fas fa-clock"></i></div>
            <div class="stat-content">
              <h3 id="avgDuration">0s</h3>
              <p>Duração Média</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon stat-icon--warning"><i class="fas fa-percentage"></i></div>
            <div class="stat-content">
              <h3 id="successRate">0%</h3>
              <p>Taxa de Sucesso</p>
            </div>
          </div>
        </div>

        <!-- Execution History Chart -->
        <div class="history-chart-section">
          <div class="card">
            <div class="card__header">
              <h2>Histórico de Execuções</h2>
              <div class="period-filters" id="historySection">
                <button class="period-btn" data-history-period="24h">24h</button>
                <button class="period-btn period-btn--active" data-history-period="7d">7 dias</button>
                <button class="period-btn" data-history-period="30d">30 dias</button>
              </div>
            </div>
            <div class="card__body">
              <div class="chart-container" style="position: relative; height: 300px;">
                <canvas id="historyChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts and History -->
        <div class="content-grid">
          <!-- Pie Chart Section -->
          <div class="chart-section" style="margin-top: 20px;">
            <div class="card">
              <div class="card__header" style="text-align: center;">
                <h2>Status dos Testes</h2>
              </div>
              <div class="card__body">
                <div class="chart-container" style="position: relative; height: 300px;">
                  <canvas id="statusChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Execution History -->
          <div class="history-section">
            <div class="card">
              <div class="card__header">
                <h2>Últimas Execuções</h2>
                <div class="history-actions">
                  <input type="date" id="dateFilter" class="form-control" />
                  <select id="statusFilter" class="form-control">
                    <option value="">Todos os status</option>
                    <option value="passed">Aprovado</option>
                    <option value="failed">Falhado</option>
                  </select>
                </div>
              </div>
              <div class="card__body">
                <div class="execution-table">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Data/Hora</th>
                        <th>Branch</th>
                        <th>Ambiente</th>
                        <th>Status</th>
                        <th>Testes</th>
                        <th>Duração</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="executionTableBody"></tbody>
                  </table>
                </div>
                <div class="pagination" id="pagination"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Modal for Execution Details -->
  <div class="modal hidden" id="executionModal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2>Detalhes da Execução</h2>
        <button class="modal-close" id="closeModal"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="modal-tabs">
          <button class="tab-button tab-button--active" data-tab="overview">Visão Geral</button>
          <button class="tab-button" data-tab="tests">Testes</button>
          <button class="tab-button" data-tab="logs">Logs</button>
          <button class="tab-button" data-tab="artifacts">Artefatos</button>
        </div>

        <div class="tab-content">
          <!-- Overview Tab -->
          <div class="tab-panel tab-panel--active" id="overview-tab">
            <div class="execution-details">
              <div class="detail-grid">
                <div class="detail-item"><label>ID da Execução:</label><span id="modalExecutionId"></span></div>
                <div class="detail-item"><label>Data/Hora:</label><span id="modalExecutionDate"></span></div>
                <div class="detail-item"><label>Branch:</label><span id="modalExecutionBranch"></span></div>
                <div class="detail-item"><label>Ambiente:</label><span id="modalExecutionEnvironment"></span></div>
                <div class="detail-item"><label>Autor:</label><span id="modalExecutionAuthor"></span></div>
                <div class="detail-item"><label>Commit:</label><span id="modalExecutionCommit"></span></div>
                <div class="detail-item"><label>Duração:</label><span id="modalExecutionDuration"></span></div>
                <div class="detail-item"><label>Status:</label><span id="modalExecutionStatus"></span></div>
              </div>
              <div class="github-link">
                <a href="#" id="modalGithubLink" target="_blank" class="btn btn--outline">
                  <i class="fab fa-github"></i> Ver no GitHub Actions
                </a>
              </div>
            </div>
          </div>

          <!-- Tests Tab -->
          <div class="tab-panel" id="tests-tab">
            <div class="tests-list" id="modalTestsList"></div>
          </div>

          <!-- Logs Tab -->
          <div class="tab-panel" id="logs-tab">
            <div class="logs-container">
              <pre id="modalLogs"></pre>
            </div>
          </div>

          <!-- Artifacts Tab -->
          <div class="tab-panel" id="artifacts-tab">
            <div class="artifacts-list" id="modalArtifacts">
              <div class="artifact-item">
                <i class="fas fa-image"></i><span>screenshot-login.png</span>
                <button class="btn btn--sm btn--outline">Download</button>
              </div>
              <div class="artifact-item">
                <i class="fas fa-video"></i><span>test-recording.mp4</span>
                <button class="btn btn--sm btn--outline">Download</button>
              </div>
              <div class="artifact-item">
                <i class="fas fa-file-alt"></i><span>test-report.html</span>
                <button class="btn btn--sm btn--outline">Download</button>
              </div>
            </div>
          </div>
        </div> <!-- /tab-content -->
      </div> <!-- /modal-body -->
    </div> <!-- /modal-content -->
  </div> <!-- /modal -->

  <!-- Loading Overlay -->
  <div class="loading-overlay hidden" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Executando pipeline...</p>
    </div>
  </div>
  <!-- Chart.js 4 - CDN direto -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Date-fns Adapter - CDN direto -->
  <script
    src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

  <!-- Seu app principal -->
  <script src="/app.js?v=20250910-pagespeed" defer></script>

  <!-- ===========================
     Modal de Métricas PageSpeed  
     =========================== -->
  <div id="metricsModal" class="metrics-modal hidden">
    <div class="metrics-modal-content">
      <!-- Header -->
      <div class="metrics-header">
        <div class="metrics-title">
          <h1>Métricas de PageSpeed</h1>
          <p>Resumo das lojas com foco em desempenho, acessibilidade e SEO.</p>
        </div>
        <button class="close-btn" onclick="closeMetricsPage()">
          Voltar
        </button>
      </div>

      <!-- Cards de Métricas Resumo -->
      <div class="metrics-overview">
        <div class="metric-card">
          <div class="metric-value" id="avg-performance">--</div>
          <div class="metric-total">/100</div>
          <div class="metric-label">Performance</div>
        </div>

        <div class="metric-card">
          <div class="metric-value" id="avg-accessibility">--</div>
          <div class="metric-total">/100</div>
          <div class="metric-label">Acessibilidade</div>
        </div>

        <div class="metric-card">
          <div class="metric-value" id="avg-best-practices">--</div>
          <div class="metric-total">/100</div>
          <div class="metric-label">Boas Práticas</div>
        </div>

        <div class="metric-card">
          <div class="metric-value" id="avg-seo">--</div>
          <div class="metric-total">/100</div>
          <div class="metric-label">SEO</div>
        </div>
      </div>

      <!-- Tabela de Lojas -->
      <div class="metrics-table-section">
        <div class="table-header">
          <h2>Lojas monitoradas</h2>
          <button onclick="refreshAllPageSpeed()" class="btn-refresh">
            🔄 Atualizar
          </button>
        </div>

        <div class="table-container">
          <table class="metrics-table">
            <thead>
              <tr>
                <th>Loja</th>
                <th>URL</th>
                <th>Performance</th>
                <th>Acessibilidade</th>
                <th>SEO</th>
              </tr>
            </thead>
            <tbody id="metrics-table-body">
              <tr class="loading-row">
                <td colspan="5">
                  <div class="loading-spinner">⏱️ Carregando métricas...</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="metrics-note">
          <p>💡 Substitua estes dados por resultados reais do PageSpeed quando conectar sua API.</p>
        </div>
      </div>

      <!-- Footer -->
      <div class="metrics-footer">
        <p>🔗 Integre relatórios Lighthouse/PageSpeed para preencher estes números automaticamente.</p>
      </div>
    </div>
  </div>
</body>

</html>